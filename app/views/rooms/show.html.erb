<div data-room-id="<%= @room.id %>" data-current-game="<%= @current_game&.id %>">
  <h1>Room: <%= @room.name %> (Code: <%= @room.code %>)</h1>

  <% if current_user %>
    <p>Welcome, <%= current_user.name %>!</p>

    <div class="game-controls">
      <%= button_to "Start Game", start_game_room_path(@room), method: :post %>
      <%= button_to "Next Question", next_question_room_path(@room), method: :post %>
    </div>

    <div id="game-area">
      <div id="question-content">
        <% if @current_game&.current_question %>
          <h3><%= @current_game.current_question.title %></h3>
          <p><strong>Toss-up:</strong> <%= @current_game.current_question.toss_up&.content %></p>
          <p><em>Format: <%= @current_game.current_question.toss_up&.format %></em></p>
        <% else %>
          <p>Click "Start Game" to begin!</p>
        <% end %>
      </div>

      <div id="buzz-indicator" style="display: none;">
        <!-- Shows who buzzed -->
      </div>

      <button id="buzz-button" onclick="window.roomChannel && window.roomChannel.buzzIn()"
              <%= @current_game&.current_question ? '' : 'disabled' %>>
        BUZZ IN!
      </button>

      <div id="answer-form" style="display: none;">
        <input type="text" id="answer-input" placeholder="Your answer...">
        <button onclick="submitAnswer()">Submit Answer</button>
      </div>
    </div>

    <!-- Hidden data for JavaScript -->
    <script type="application/json" id="current-question-data">
      <% if @current_game&.current_question %>
        {
          "id": <%= @current_game.current_question.id %>,
          "title": "<%= j(@current_game.current_question.title) %>",
          "toss_up": "<%= j(@current_game.current_question.toss_up&.content) %>",
          "format": "<%= j(@current_game.current_question.toss_up&.format) %>"
        }
      <% else %>
        null
      <% end %>
    </script>
  <% else %>
    <!-- Simple name entry form -->
    <div class="join-form">
      <h3>Enter your name to join this room:</h3>
      <%= form_with url: join_room_path(@room), method: :post, local: true do |form| %>
        <%= form.text_field :name, placeholder: "Your name", required: true %>
        <%= form.submit "Join Room" %>
      <% end %>
    </div>
  <% end %>
</div>

<% if current_user %>
<script>
  function submitAnswer() {
    const answer = document.getElementById('answer-input').value
    const buzzId = document.getElementById('answer-form').dataset.buzzId
    if (window.roomChannel) {
      window.roomChannel.submitAnswer(buzzId, answer)
    }
  }
</script>
<% end %>